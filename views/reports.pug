doctype html
html
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title Reports - MWF
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet")
    link(href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet")
    link(rel='stylesheet' href='/css/style.css')
    style.
      body {
        background-color: burlywood;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      .navbar-brand { font-weight: bold; }
      .card {
        background-color: burlywood;
        color: #4e342e;
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      }
      .form-control, .form-select { border-radius: 0.5rem; height: 38px; margin-bottom: 10px; }
      .btn-primary, .btn-danger { border-radius: 0.5rem; font-size: 0.9rem; padding: 0.35rem 0; }
      .btn.btn-primary { background:black; color:white; }
      .btn.btn-danger#generatePDF { background:black; color:white; }
      .text-center{
        color: white;
      }
  body
    // Navbar
    nav.navbar.navbar-expand-lg.navbar-dark.bg-dark
      .container-fluid
        a.navbar-brand(href='/dashboard') MWF Dashboard
        button.navbar-toggler(type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav")
          span.navbar-toggler-icon
        #navbarNav.collapse.navbar-collapse.justify-content-end
          ul.navbar-nav
            li.nav-item
              a.nav-link(href='/dashboard') Dashboard
            li.nav-item
              a.nav-link(href='/saleslist') Saleslist
            li.nav-item
              a.nav-link(href='/stocklist') Stocklist
            li.nav-item
              a.nav-link.active(href='/reports') Reports
            li.nav-item
              a.nav-link.text-danger(href='/logout') Log out

    // Page Content
    .container.my-5
      .row.justify-content-center
        .col-md-8
          .card
            h4.text-center.mb-4 Filter Reports
            // Filter Form
            form#reportFilterForm(method='GET', action='/reports/generate')
              label.form-label(for='fromDate') From
              input.form-control(type='date', name='fromDate', required value=fromDate)
              
              label.form-label(for='toDate') To
              input.form-control(type='date', name='toDate', required value=toDate)
              
              label.form-label(for='period') Period
              select.form-select(name='period', required)
                option(value='daily' selected=(period==='daily')) Daily
                option(value='weekly' selected=(period==='weekly')) Weekly
                option(value='monthly' selected=(period==='monthly')) Monthly
                option(value='yearly' selected=(period==='yearly')) Yearly
              
              .d-flex.flex-column.gap-2.mt-3
                button.btn.btn-primary(type='submit') Generate
                button.btn.btn-danger#generatePDF(type='button') PDF

      if salesData && salesData.length
        .mt-4
          h5.text-center Report Results
          table#reportTable.table.table-bordered.table-striped
            thead
              tr
                th Date / Period
                th Total Sales
                th Quantity Sold
            tbody
              each sale in salesData
                tr
                  td= sale._id
                  td= sale.totalSales
                  td= sale.totalQuantity
          h5.mt-3.text-end Grand Total Sales: #{totalSales} Shs

    // Scripts
    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js")
    script(src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js")
    script(src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js")
    script.
      const { jsPDF } = window.jspdf;
      document.getElementById('generatePDF').addEventListener('click', () => {
        const doc = new jsPDF();
        doc.setFontSize(18);
        doc.text("MWF Report", 20, 20);

        const table = document.getElementById('reportTable');
        if (table) {
          doc.autoTable({ html: table, startY: 30 });
        }

        const totalSales = !{totalSales || 0};
        doc.setFontSize(14);
        doc.text(`Grand Total Sales: ${totalSales} Shs`, 20, doc.lastAutoTable.finalY + 10);

        doc.save("MWF_Report.pdf");
      });
