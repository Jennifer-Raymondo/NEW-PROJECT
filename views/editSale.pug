extends layout

block navbar
  nav.navbar.navbar-expand-lg.navbar-dark.bg-dark
    .container-fluid
      a.navbar-brand(href='/dashboard') MWF
      button.navbar-toggler(type='button', data-bs-toggle='collapse', data-bs-target='#navbarNav', aria-controls='navbarNav', aria-expanded='false', aria-label='Toggle navigation')
        span.navbar-toggler-icon
      #navbarNav.collapse.navbar-collapse.justify-content-end
        ul.navbar-nav.ms-auto
          li.nav-item
            a.nav-link(href='/dashboard') Dashboard
          li.nav-item
            a.nav-link(href='/sales') Sales
          li.nav-item
            a.nav-link(href='/saleslist') Saleslist
          li.nav-item
            a.nav-link(href='/salesRecords') SalesRecords
          li.nav-item
            a.nav-link.text-danger(href='/logout') Logout

block content
  .container.mt-5
    .sales-form-container.mx-auto(style='max-width: 700px;')
      h2.text-center.mb-4 Edit Sale
      form#editSaleForm(action=`/sales/edit/${sale._id}` method='post')
        
        // Customer Info: Name and Date
        .row.mb-3
          .col-md-6
            label.form-label Customer Name
            input.form-control(type='text' name='customerName' required value=sale.customerName)
          .col-md-6
            label.form-label Date
            input.form-control(type='date' name='Date' required value=sale.Date ? sale.Date.toISOString().slice(0,10) : '')

        // Product Info: Type and Name
        .row.mb-3
          .col-md-6
            label.form-label Product Type
            select.form-select(name='productType' required)
              option(value='') Select Type
              option(value='wood' selected=sale.productType=='wood') Wood
              option(value='furniture' selected=sale.productType=='furniture') Furniture
          .col-md-6
            label.form-label Product Name
            input.form-control(type='text' name='productName' required value=sale.productName)

        // Quantity and Transport
        .row.mb-3
          .col-md-6
            label.form-label Quantity
            input.form-control(type='number' name='quantity' required value=sale.quantity)
          .col-md-6
            label.form-label Include Transport (5%)
            select.form-select(name='transport' required)
              option(value='') Choose
              option(value='Yes' selected=sale.transport=='Yes') Yes
              option(value='No' selected=sale.transport=='No') No

        // Selling Price and Total Amount side by side
        .row.mb-3
          .col-md-6
            label.form-label Selling Price (UGX)
            input.form-control(type='number' required name='sellingPrice' value=sale.sellingPrice placeholder='e.g. 250000')
          .col-md-6
            label.form-label Total Amount (UGX)
            input#totalAmount.form-control(type='number' readonly value=(sale.quantity * sale.sellingPrice) style='background-color:#f8f9fa; font-weight:bold;')

        // Payment Type and Sales Agent
        .row.mb-4
          .col-md-6
            label.form-label Payment Type
            select.form-select(name='paymentType' required)
              option(value='') Choose
              option(value='cash' selected=sale.paymentType=='cash') Cash
              option(value='cheque' selected=sale.paymentType=='cheque') Cheque
              option(value='bankOverdraft' selected=sale.paymentType=='bankOverdraft') Bank Overdraft
          .col-md-6
            label.form-label Sales Agent
            input.form-control(type='text' name='salesAgent' required value=sale.salesAgent)

        // Submit
        .d-flex.justify-content-between
          a.btn.btn-secondary(href='/saleslist') Cancel
          button.btn.btn-brown(type='submit') Update Sale

  script.
    document.addEventListener('DOMContentLoaded', function () {
      const quantityInput = document.querySelector('input[name="quantity"]');
      const priceInput = document.querySelector('input[name="sellingPrice"]');
      const totalInput = document.getElementById('totalAmount');

      function calculateTotal() {
        const qty = parseFloat(quantityInput.value) || 0;
        const price = parseFloat(priceInput.value) || 0;
        totalInput.value = (qty * price).toFixed(2);
      }

      quantityInput.addEventListener('input', calculateTotal);
      priceInput.addEventListener('input', calculateTotal);
    });

  script(src='/js/formValidation.js')
