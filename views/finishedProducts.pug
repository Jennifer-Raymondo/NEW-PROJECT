doctype html
html
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title Finished Products - MWF
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet")
    link(href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet")
    link(rel='stylesheet' href='/css/style.css')
    style.
      .summary-card p { 
        font-size: 0.9rem; 
        font-weight: 600; 
        background-color: burlywood;
        color: #4e342e;
        border-radius: 0.75rem;
        transition: transform 0.2s ease-in-out;
        background-size: contain;
      }
      .summary-card:hover { transform: translateY(-3px); }

  body
    // Navbar
    nav.navbar.navbar-expand-lg.navbar-dark.bg-dark
      .container-fluid
        a.navbar-brand(href="/dashboard") MWF Dashboard
        button.navbar-toggler(type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav")
          span.navbar-toggler-icon
        #navbarNav.collapse.navbar-collapse.justify-content-end
          ul.navbar-nav
            li.nav-item
              a.nav-link(href='/dashboard') Dashboard
            //- li.nav-item
            //-   a.nav-link(href='/sales') Sales
            //- li.nav-item
            //-   a.nav-link(href='/saleslist') Saleslist
            //- li.nav-item
            //-   a.nav-link(href='/salesRecords') SalesRecords
            li.nav-item
              a.nav-link(href='/stock') Stock
            li.nav-item
              a.nav-link(href='/stocklist') Stocklist
            li.nav-item
              a.nav-link(href='/finishedProducts') products
            li.nav-item
              a.nav-link.text-danger(href='/logout') Log out

    // Content
    .container.my-5
      h2.mb-4  Available Products Overview

      // Overview Cards
      .row.g-3.mb-4
        .col-md-4
          .card.shadow-sm.text-center.summary-card.p-3
            h5 Total Products
            p #{finishedProducts.totalQuantity} items
        .col-md-4
          .card.shadow-sm.text-center.summary-card.p-3
            h5 Stock Value
            p #{finishedProducts.totalValue} Shs

      // Table
      .card.shadow-sm.mb-5
        .card-body
          h5.mb-3 Product Inventory
          table.table.table-striped.table-hover
            thead.table-dark
              tr
                th Date Registered
                th Product Name
                th Quantity
                th Cost Price
                th Total Amount
            tbody
              if finishedProducts.items && finishedProducts.items.length
                each item in finishedProducts.items
                  tr
                    // Format date same as in sales file
                    td #{item.formattedDate}
                    td #{item.productName}
                    td #{item.quantity}
                    td #{item.costPrice.toLocaleString()} Shs
                    td #{(item.quantity * item.costPrice).toLocaleString()} Shs
              else
                tr
                  td(colspan='5').text-center.text-muted No stock records found.

      // Charts
      .row.g-4
        .col-md-6
          .card.shadow-sm.p-3
            h6.text-center.mb-3 Stock Distribution
            canvas#finishedProductsPieChart
        .col-md-6
          .card.shadow-sm.p-3
            h6.text-center.mb-3 Stock by Quantity
            canvas#finishedProductsBarChart

    // Scripts
    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js")
    script(src="https://cdn.jsdelivr.net/npm/chart.js")
    script.
      const ctxPie = document.getElementById('finishedProductsPieChart');
      const ctxBar = document.getElementById('finishedProductsBarChart');
      new Chart(ctxPie, {
        type: 'pie',
        data: {
          labels: !{JSON.stringify(finishedProducts.chartData.map(i => i.productName))},
          datasets: [{
            data: !{JSON.stringify(finishedProducts.chartData.map(i => i.quantity))},
            backgroundColor: ['#6f4e37','#8d6e63','#a1887f','#bcaaa4','#d7ccc8']
          }]
        }
      });
      new Chart(ctxBar, {
        type: 'bar',
        data: {
          labels: !{JSON.stringify(finishedProducts.chartData.map(i => i.productName))},
          datasets: [{
            label: 'Quantity',
            data: !{JSON.stringify(finishedProducts.chartData.map(i => i.quantity))},
            backgroundColor: '#6f4e37'
          }]
        }
      });
